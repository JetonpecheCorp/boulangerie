<h2 mat-dialog-title>{{ estModeAjouter() ? "Nouvelle commande" : "Modifier la commande" }}</h2>
<mat-dialog-content>

    <!-- produit à choisir -->
    <div [formGroup]="form">
        <div class="row">

            <!-- date pour le -->
            <div class="col-6">
                <mat-form-field style="margin-top: 10px; margin-bottom: 10px;">
                    <mat-label>Pour le</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="date">
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
            </div>

            <!-- defini si pour livraison -->
            <div class="col-6" style="margin: auto 0">
                  <mat-checkbox aria-label="Livraison ?"
                                formControlName="estLivraison">
                    Livraison ?
                </mat-checkbox>
            </div>

            <!-- client -->
            <div class="col-12">
                <mat-form-field style="margin-top: 10px; margin-bottom: 10px;">
                    <mat-label>Client</mat-label>
                    <input  type="text"
                            aria-label="Client"
                            matInput
                            [formControl]="$any(form.controls['autoCompleteClient'])"
                            [matAutocomplete]="autoClient">
                    <mat-autocomplete autoActiveFirstOption 
                                      #autoClient="matAutocomplete">
                        @for (option of dataSourceClientFiltrer(); track option.idPublic) 
                        {
                            <mat-option [value]="option.nom">{{ option.nom }}</mat-option>
                        }
                    </mat-autocomplete>
                </mat-form-field>
            </div>

            <!-- auto complete produit -->
            <div class="col-6 col-xs-12">
                <mat-form-field>
                    <mat-label>Produit</mat-label>
                    <input  type="text"
                            aria-label="Produit"
                            matInput
                            [formControl]="$any(form.controls['autoComplete'])"
                            [matAutocomplete]="auto">
                    <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
                        @for (option of dataSourceFiltrer(); track option.idPublic) 
                        {
                            <mat-option [value]="option.nom">{{ option.nom }}</mat-option>
                        }
                    </mat-autocomplete>
                </mat-form-field>
            </div>

            <div class="col-4 col-xs-10">
                <mat-form-field>
                    <mat-label>Quantité</mat-label>
                    <input  #inputQte
                            type="number"
                            aria-label="Produit"
                            value="1"
                            min="1"
                            matInput
                            required />
                </mat-form-field>
                @if(!inputQte.validity.valid)
                {
                    <mat-error>{{ inputQte.validationMessage }}</mat-error>
                }
            </div>

            <div class="col-2 col-xs-2" (click)="AjouterProduit()">
                <button mat-mini-fab>
                    <mat-icon>add</mat-icon>
                </button>
            </div>
        </div>
    </div>

    <hr>

    <!-- liste produit choisi -->
    <div class="row">

        @for (element of form.value.listeProduit; track element.idPublic) 
        {     
            <div style="margin-bottom: 15px;" class="col-6 col-xs-12">
                <mat-form-field>
                    <mat-label>Produit</mat-label>
                    <input  type="text"
                            aria-label="Produit"
                            matInput
                            readonly
                            [value]="element.nom">
                </mat-form-field>
            </div>

            <div style="margin-bottom: 15px;" class="col-4 col-xs-10">
                <mat-form-field>
                    <mat-label>Quantité</mat-label>
                    <input  type="number"
                            aria-label="Produit"
                            [(ngModel)]="element.quantite"
                            min="1"
                            matInput>
                </mat-form-field>
                @if (element.quantite <= 0) 
                {
                    <mat-error>Doit être supérieur à 0</mat-error>
                }
            </div>

            <div class="col-2 col-xs-2" (click)="SupprimerProduit($index, element)">
                <button mat-mini-fab>
                    <mat-icon>delete</mat-icon>
                </button>
            </div>
        }
    </div>

</mat-dialog-content>
<mat-dialog-actions>
    <button mat-dialog-close mat-button>Fermer</button>

    <app-button [label]="estModeAjouter() ? 'Ajouter' : 'Modifier'" 
                [btnClicker]="btnClicker()" 
                (onClick)="Ajouter()" />
</mat-dialog-actions>